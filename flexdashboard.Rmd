---
title: "xxxxxxx"
output: 
  flexdashboard::flex_dashboard:
    theme:
      version: 4
      bootswatch: sketchy
    orientation: rows
    vertical_layout: fill
    source_code: embed
---

```{r setup, include=FALSE}
library(flexdashboard)
library(ggplot2)
library(naniar)
library(readxl)
library(tidyverse)
library(plotly)
library(ggmap)
library(gganimate)
library(gifski)
library(png)
# install.packages("bslib")
library(bslib)
library(kableExtra)
```


Overview {data-icon="fa-globe"}
=============================
Inputs {.sidebar data-width=400}
-------------------------------------

### Table of Contents





Row{data-height=150}
--------------------------------------

### XXXXX

![](https://media.giphy.com/media/3otO6zntMrmhpvaYX6/giphy.gif)



Row{data-height=600}
--------------------------------------

### Introduction

XXXXXXXXXXXXXXXXXXXXXx


```{r, include=FALSE}
excel_sheets("data/API_4_DS2_en_excel_v2_2252569.xls")
data_income <- read_excel("data/CLASS.xls", range = anchored("C5", dim = c(220,5))) %>% 
  select(-X) %>% 
  filter(Economy != "x")
```

```{r, include=FALSE}
df<- read_excel("Data/API_4_DS2_en_excel_v2_2252569.xls", sheet = 1, range = "A4:BM42772") %>% 
  select("Country Name", 
         "Country Code",
         "Indicator Name", 
         "2000":"2019") %>% 
  rename("country_name" = "Country Name",
         "indicator" = "Indicator Name",
         "country_code" = "Country Code")
```

```{r, include=FALSE}
df %>%
  group_by(country_name) %>%
  miss_var_summary() %>% 
  arrange(-pct_miss)
```

```{r}
df_filter <- df %>% 
  filter(!(country_name %in% c("Faroe Islands",
                          "Greenland",
                          "Isle of Man",
                          "Not classified",
                          "St. Martin (French part)",
                          "Northern Mariana Islands",
                          "Kosovo",
                          "American Samoa",
                          "Gibraltar",
                          "Sint Maarten (Dutch part)",
                          "Turks and Caicos Islands",
                          "Channel Islands",
                          "Guam",
                          "French Polynesia",
                          "Curacao",
                          "New Caledonia",
                          "Virgin Islands (U.S.)",
                          "Nauru",
                          "Palau",
                          "Somalia",
                          "Guinea-Bissau")))
       
```

```{r, include=FALSE}
data_joined <- df_filter %>% 
    left_join(data_income, by = c("country_name" = "Economy",
                                "country_code" = "Code")) 
```






Literacy Rate {data-icon="ion-android-search"}
=============================
Row{data-height=150}
--------------------------------------

### Literacy Rate for Adult and Youth
```{r rw}
valueBox(value = "Literacy Rate for Adult and Youth üìö", icon = "ion-university", caption = "GLobal - Reginal - Income Levels", color = "skyblue")
```


Row{data-height=500}
----------------------------------

### Global Literacy Rate

```{r longdata-my}
# filter and pivot data to longer form
lit_long <- data_joined %>% 
  filter(str_detect(indicator, "Literacy")) %>% 
  filter(str_detect(indicator, "total")) %>% 
  pivot_longer(cols = c("2000":"2019"),
               names_to = "year",
               values_to = "rate")
# remove strings in indicator variable
lit_long$indicator <- lit_long$indicator %>% 
  substring(16) %>%
  str_remove("\\(") %>% 
  str_remove("\\)") %>% 
  str_remove("\\%") %>% 
  str_remove("total  of people ")
```

```{r plot1my, eval = FALSE, catche = TRUE}
# animation
plot1 <- lit_long %>% 
  filter(country_name == "World") %>% 
  ggplot(aes(x = year,
             y = rate,
             fill = indicator)) +
  geom_col(position = "dodge", width = 0.7) +
  theme_light() +
  ylim(0, 100) +
  theme(axis.text.x = element_text(angle = 60, vjust = 0.5, hjust=0.5)) +
  scale_fill_brewer(palette = "Paired") +
  labs(x = "Year",
       y = "Literacy Rate",
       fill = "Age") +
  ggtitle("Global Literacy Rate for Adult and Youth between 2000-2019") +
  transition_time(as.numeric(year)) +
  enter_grow() +
  shadow_mark(past = TRUE)

animate(plot1, fps = 20, duration = 15, end_pause = 80)
```


Row{data-height=600}
----------------------------------


### Regional Literacy Rate

```{r plot2my, eval = FALSE, catche = TRUE}
# animation
plot2 <- lit_long %>% 
  filter(country_name %in% c("Central Europe and the Baltics",
                             "East Asia & Pacific",
                             "Europe & Central Asia",
                             "Latin America & Caribbean",
                             "Middle East & North Africa",
                             "South Asia",
                             "Sub-Saharan Africa")) %>% 
  group_by(indicator) %>% 
  ggplot(aes(x = year,
             y = rate,
             group = country_name,
             color = country_name)) +
  geom_line() +
  facet_wrap(~indicator) +
  theme_light() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=0.5)) +
  scale_colour_brewer(palette = "Paired") +
  labs(x = "Year",
       y = "Literacy Rate",
       color = "Regions") +
  ggtitle("Literacy Rate for Adult and Youth in Differenet Regions") +
  transition_reveal(as.numeric(year)) +
  enter_grow() +
  shadow_mark(past = TRUE)

animate(plot2, fps = 20, duration = 8, end_pause = 80)
```


### Literacy Rate for Different Income Groups

```{r plot3my, eval = FALSE, catche = TRUE}
# animation
plot3 <- lit_long %>% 
  filter(country_name %in% c("Low income",
                             "Lower middle income",
                             "Middle income",
                             "Upper middle income")) %>% 
  ggplot(aes(x = year,
             y = rate,
             fill = indicator)) +
  geom_col(position = "dodge") +
  facet_wrap(~country_name, 
             ncol = 2) +
  theme_light() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=0.5)) +
  scale_fill_brewer(palette = "Paired") +
  labs(x = "Year",
       y = "Literacy Rate",
       fill = "Age") +
  ggtitle("Literacy Rate for Adult and Youth in Differenet Income Groups")  +
  transition_time(as.numeric(year)) +
  enter_grow() +
  shadow_mark(past = TRUE)
  
animate(plot3, fps = 20, duration = 20, end_pause = 80)
```




Section 2 {data-icon="ion-android-search"}
=============================
Row{data-height=150}
--------------------------------------


### ???
```{r}
valueBox(value = 2,icon = "ion-university",caption = "???", color = "orange")
```


Row
--------------------------------------

```{r}

```




Children Out of School {data-icon="ion-android-search"}
=============================
Row{data-height=150}
--------------------------------------

### Percentage of children out of primary school
```{r}
valueBox(value = "Percentage of children out of primary school üè´", icon = "ion-university", caption = "Regional - Gender Differnce", color = "green")
```

Row {.tabset data-height=700}
--------------------------------------

### **Percentage of Children Out of School - Total**
```{r fig.cap="Percentage of children out of school in primary school age", fig.width=12, fig.height=6}
df_outsch <- data_joined %>% 
  filter(indicator %in% c("Children out of school (% of primary school age)",
                          "Children out of school, male (% of male primary school age)",
                          "Children out of school, female (% of female primary school age)")) %>% 
  pivot_longer(cols = "2000":"2019",
               names_to = "year",
               values_to = "value") %>% 
  pivot_wider(id_cols = -indicator,
              names_from = indicator,
              values_from = value) %>% 
  rename("children_out_of_school_tot_%" = `Children out of school (% of primary school age)`,
         "children_out_of_school_m_%" = `Children out of school, male (% of male primary school age)`,
         "children_out_of_school_f_%" = `Children out of school, female (% of female primary school age)`)

outsch <- df_outsch %>% 
  filter(country_name %in% c("East Asia & Pacific",
                             "Europe & Central Asia",
                             "Latin America & Caribbean",
                             "Middle East & North Africa",
                             "North America",
                             "South Asia",
                             "Sub-Saharan Africa")) 

income_level <- data_income %>% 
  select(Region,`Income group`)

os_clean <- outsch %>% 
  left_join(income_level,
            by = c("country_name" = "Region")) %>% 
  select(-c(country_code, Region, `Income group.x`)) %>% 
  rename("region" = country_name,
         "income_group" = `Income group.y`) %>% 
  mutate(year = as.numeric(year))

os_clean <- unique(os_clean[ , 1:5])

plot1_cos <- os_clean %>% 
  ggplot(aes(x = year, y = `children_out_of_school_tot_%`, colour = region)) +
  geom_line() +
  labs(x = "Year", y = "Percentage") +
  scale_fill_brewer(palette="Paired") +
  theme_light() 

ggplotly(plot1_cos)
```   

### **Difference in Percentage by Gender**

```{r fig.cap="Percentage of children out of school in primary school age by gender", fig.width=12, fig.height=6}
os_gender <- os_clean %>% 
  rename("male" = `children_out_of_school_m_%`,
         "female" = `children_out_of_school_f_%`) %>% 
  pivot_longer(cols = c(male,female),
               names_to = "gender",
               values_to = "percentage") %>% 
  select(-`children_out_of_school_tot_%`)

plot2_cos <- os_gender %>% 
ggplot(aes(x= year, y = percentage, fill = gender)) +
  facet_wrap(~region,
             ncol = 2) +
  geom_bar(stat = "identity",
           position = "dodge") +
  xlim(c(2000,2019)) +
  labs(x = "Year", y = "Percentage") +
  scale_fill_brewer(palette="Paired") +
  theme_light() 

ggplotly(plot2_cos)

```

### **Difference in Percentage by Gender in 2000 and 2019**

```{r}
os_diff <- os_clean %>% 
  filter(year %in% c(2000,2019)) %>% 
  group_by(region, year) %>% 
  summarise(per_diff = `children_out_of_school_f_%` - `children_out_of_school_m_%`,
            .groups = "drop") %>% 
  pivot_wider(names_from = year,
              values_from = per_diff)

os_diff[order(-os_diff$`2000`),] %>% 
  kable(col.names = c("Region", 
                      "Difference in percentage - 2000",
                      "Difference in percentage - 2019"),
      align = "c",
      caption = "Difference in percentage of primary-school-age children out of school between males and females", 
      digits = 2) %>% 
  kable_styling(bootstrap_options = c("striped","hover"),
                latex_options = "HOLD_position")
```

Column {.sidebar data-width=400}
--------------------------------------
> Key Findings

* From the line graph 

  * Sub-Saharan Africa has the highest percentage of primary-school-age children out of school
  * Followed by South Asia and Middle East & North Africa
  * The percentage dropped for all these three regions from 2000 to 2019

* From the bar plot

  * More females in primary school age are out of school compare with males in Middle East & North Africa, South Asia and Sub-Saharan Africa

* From the table
  
  * The difference in percentage is the highest in South Asia in 2000, but it dropped significantly in the two decades
  * Same trend can be observed in Middle East & North Africa
  * Percentage of male primary-school-aged children who are out of school is slightly higher than female in Europe & Central Asia and Latin America & Caribbean in 2019




Section 4 {data-icon="ion-android-search"}
=============================
Row{data-height=150}
--------------------------------------

### ???
```{r}

valueBox(value = 2,icon = "ion-university",caption = "???", color = "coral")
```


Row
----------------------------------

### Number of Offences by Gender
```{r}


```
