---
title: " "
author:
- familyname: YANG
  othernames: Mengyuan
  address: Monash University
  email: "myan0065@student.monash.edu"
  correspondingauthor: true
  qualifications:  Master of Business Analytics
- familyname: BATSAIKHAN
  othernames: Zoljargal
  address: Monash University
  email: "zbat0001@student.monash.edu"
  correspondingauthor: true
  qualifications: Master of Business Analytics
- familyname: WANG
  othernames: Xinrui
  address: Monash University
  email: "xwan0274@student.monash.edu"
  correspondingauthor: true
  qualifications: Master of Business Analytics
- familyname: GOH
  othernames: Xueqi
  address: MONASH UNIVERSITY
  email: "xgoh0002@student.monash.edu"
  correspondingauthor: true
  qualifications: Master of Business Analytics
department: Our consultancy \newline Mengyuan YANG &\newline Zoljargal BATSAIKHAN &\newline Xinrui WANG &\newline Xueqi GOH
organization: Monash University
bibliography: references.bib
biblio-style: authoryear-comp
linestretch: 1.5
output:
  bookdown::pdf_document2:
    template: monashreport2.tex
    fig_caption: yes
    fig_height: 5
    fig_width: 8
    includes:
      in_header: preamble.tex
    keep_tex: yes
    number_sections: yes
    citation_package: biblatex
    toc: true
---

```{r , echo = FALSE, message = FALSE, warning = FALSE}
# Libraries
library(tidyverse)
library(readr)
library(kableExtra)
library(bookdown)
library(ggplot2)
library(gridExtra)
library(tinytex)
library(readxl)
library(naniar)
```


\section*{Introduction}

```{r}
excel_sheets("data/API_4_DS2_en_excel_v2_2252569.xls")

data_income <- read_excel("data/CLASS.xls", range = anchored("C5", dim = c(220,5))) %>% 
  select(-X) %>% 
  filter(Economy != "x")
```

```{r}
df<- read_excel("Data/API_4_DS2_en_excel_v2_2252569.xls", sheet = 1, range = "A4:BM42772") %>% 
  select("Country Name", 
         "Country Code",
         "Indicator Name", 
         "2000":"2019") %>% 
  rename("country_name" = "Country Name",
         "indicator" = "Indicator Name",
         "country_code" = "Country Code")
```


```{r}
df %>%
  group_by(country_name) %>%
  miss_var_summary() %>% 
  arrange(-pct_miss)
```

```{r}
df_filter <- df %>% 
  filter(!(country_name %in% c("Faroe Islands",
                          "Greenland",
                          "Isle of Man",
                          "Not classified",
                          "St. Martin (French part)",
                          "Northern Mariana Islands",
                          "Kosovo",
                          "American Samoa",
                          "Gibraltar",
                          "Sint Maarten (Dutch part)",
                          "Turks and Caicos Islands",
                          "Channel Islands",
                          "Guam",
                          "French Polynesia",
                          "Curacao",
                          "New Caledonia",
                          "Virgin Islands (U.S.)",
                          "Nauru",
                          "Palau",
                          "Somalia",
                          "Guinea-Bissau")))
       
```

```{r}
data_joined <- df_filter %>% 
    left_join(data_income, by = c("country_name" = "Economy",
                                "country_code" = "Code")) 
```

\section*{Mengyun}


\section*{Zoljargal}


\section*{Xinrui}


\section*{Xueqi}

This section discuss the pupil-teacher ratio from 2000-2019
```{r Plot1}
df_xq <- data_joined %>%
   pivot_longer(cols = c("2000":"2019"),
               names_to = "year",
               values_to = "value") %>%
 dplyr::filter(str_detect(indicator, 'Pupil-teacher ratio') & !str_detect(value, "NA") & !str_detect(Region, "NA")) %>%
 rename("Income_group" = 'Income group',
        "Indicator" = "indicator") 

df2 <- df_xq %>%
  group_by(Indicator, Region)
  
  time_figure <- ggplot(df2, aes(x = year,
             y = value,
             fill = Indicator)) +
  geom_col(alpha = 0.8, width = 0.85, position = "fill") +
  scale_fill_brewer(palette = "Dark2") +
  scale_y_continuous(expand = c(0, 0.1)) +
  coord_flip() +
  
  labs(
    tittle = "Pupil-teacher ratio (%) between 2000-2019",
    x = "Years",
    y = "Pupil-teacher ratio (%)"
  ) +
  theme_minimal(base_family = "Roboto Condensed") +
  theme(
    plot.margin = margin(0.5, 0.5, 0.5, unit = "cm"),
    plot.title = element_text(size = 15, face = "bold", hjust = 0.5),
    strip.text.y = element_text(angle = 270, face = "bold"),
    strip.placement = "outside",
    axis.title.x = element_text(margin = margin(t = 0.5, b = 0.5, unit = "cm")),
    axis.title.y = element_blank(),
    axis.text = element_text(size = 10),
    panel.grid.major.y = element_blank(),
  ) +
    ggtitle("Pupil-teacher ratio (%) between 2000-2019")

plotly::ggplotly(time_figure)
```  
  
Figure \@ref(fig:Plot1) Pupil-teacher ratio seems similar across 2000-2018. However, in 2019, there's a significant decrease in pupil-teacher ratio especially in tertiary level and primary level. Next, there's an increase pupil-teacher ratio in upper secondary level, secondary level and lower secondary level. 

```{r Table2}
 df3 <- df_xq %>%
  group_by(Indicator, Region) %>%
  select(Indicator, Region, value) %>%
  summarise(Average_ratio = mean(value, na.rm = TRUE)) %>% 
  arrange(Average_ratio) %>% 
  kable(caption =  "Regional Average Pupil-teacher ratio between 2000-2019") %>%
  kable_styling (bootstrap_options = c("striped", "hover")) 
  
  
df3
```    

Table \@ref(tab:Table2) indicates that the highest average ratio is 41.887322 in Sub-saharan Africa's primary level between 2000-2019 holding other variable constant. Holding other variable constant, the lowest average ratio is 7.883399 in North America's lower-secondary level between 2000-2019
  
```{r Plot2, warning=FALSE}

library(ggthemes)
df3 <- df_xq %>%
  select("Indicator", "Income_group", "value", "Region") %>%
  group_by(Income_group, Indicator, Region) %>%
  summarise(Average_ratio = mean(value, na.rm = TRUE)) 

region_ratio <- ggplot(df3, aes(x = Average_ratio,
                      y = Indicator,
                      fill = Income_group,
                      color = Income_group)) +
  geom_col() +
  facet_wrap( ~ Region) +
  theme_economist() +
  scale_fill_manual(values = economist_pal(fill = TRUE)(4)) +
  scale_color_manual(values = economist_pal(fill = TRUE)(4)) +
  theme(text = element_text(size=5),
        plot.title = element_text(hjust = 0.5)) +
  ggtitle("Average pupil-teacher ratio on different income group in each region")
  
plotly::ggplotly(region_ratio)

```

  
Figure \@ref(fig:Plot2) Interestingly, it seems that Sub-Saharan Africa, South Asia and Middle East & North Africa has greater proportion in low income group comparing to other countries.  Middle East & North Africa and Sub-Saharan Africa has greater average pupil-teacher ratio in primary level. Europe& Central Asia has similar average pupil-teacher ratio across region. East Asia & Pacific and Latin America & Caribbean has similar average pupil-teacher ratio.
  

  













\section*{Conclusion}
